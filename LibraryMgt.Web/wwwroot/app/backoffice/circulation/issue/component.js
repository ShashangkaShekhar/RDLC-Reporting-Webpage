"use strict";var __decorate=this&&this.__decorate||function(e,t,o,s){var r,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,s);else for(var n=e.length-1;0<=n;n--)(r=e[n])&&(a=(i<3?r(a):3<i?r(t,o,a):r(t,o))||a);return 3<i&&a&&Object.defineProperty(t,o,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),forms_1=require("@angular/forms"),router_1=require("@angular/router"),platform_browser_1=require("@angular/platform-browser"),service_1=require("../../../shared/service"),IssueComponent=function(){function e(e,t,o,s){this.router=e,this.titleService=t,this.formBuilder=o,this._dataService=s,this.booklist=[],this.bookchoosed=[],this.bookissueed=[],this.bookissueedlist=[],this._getUrl="/api/circulation/getissueall",this._getbyIdUrl="/api/circulation/getissuebyid",this._saveUrl="/api/circulation/issuebook",this._getbookUrl="/api/circulation/getallbook"}return e.prototype.handleKeyboardEvent=function(e){this.keypress=e.keyCode,32==this.keypress&&(this.resmessage=null,this.reset(),this.focus())},e.prototype.ngOnInit=function(){this.titleService.setTitle("Library System | issue"),this.loadScripts(),this.createForm(),this.bookList()},e.prototype.loadScripts=function(){for(var e=["assets/js/datepicker-init.js"],t=0;t<e.length;t++){var o=document.createElement("script");o.src=e[t],o.type="text/javascript",o.async=!1,o.charset="utf-8",document.getElementsByTagName("body")[0].appendChild(o)}},e.prototype.createForm=function(){this.issueForm=this.formBuilder.group({id:0,memberId:0,memberSearch:new forms_1.FormControl(""),memberName:new forms_1.FormControl(""),email:new forms_1.FormControl(""),dueDate:new forms_1.FormControl(""),books:[]}),this.focus()},e.prototype.onChange=function(e,t){var o=this;e.preventDefault(),this._dataService.getbyid(t,this._getbyIdUrl).subscribe(function(e){null!=e?(o.bookissue=e,o.bookissueedlist=e.books,o.issueForm.setValue({id:0,memberId:o.bookissue.memberid,memberName:o.bookissue.membername,email:o.bookissue.email,dueDate:o.bookissue.duedate,memberSearch:null,books:[]})):o.reset(),o.resmessage=null},function(e){})},e.prototype.onSearch=function(){var t=this.searchTerm;this.booklist=this.booklist.filter(function(e){return 0<=e.bookname.indexOf(t)})},e.prototype.oncheckChange=function(e,t){e.preventDefault(),e.currentTarget.checked&&this.bookchoosed.push({id:t})},e.prototype.onSubmit=function(){var t=this;this.issueForm.patchValue({books:this.bookchoosed}),this.issueForm.invalid||0<this.issueForm.value.memberId&&this._dataService.save(this.issueForm.value,this._saveUrl).subscribe(function(e){t.resmessage=e.message,t.alertmessage="alert-outline-info",t.reset(),t.focus()},function(e){})},e.prototype.bookList=function(){var t=this;this._dataService.getall(this._getbookUrl).subscribe(function(e){t.booklist=e},function(e){})},e.prototype.issueedList=function(){var t=this;$("#largesizemodal").modal({backdrop:"static",keyboard:!1,show:!0}),this._dataService.getall(this._getUrl).subscribe(function(e){t.bookissueed=e},function(e){})},e.prototype.issueedListclose=function(){this.focus()},e.prototype.reset=function(){this.issueForm.setValue({id:0,memberId:0,memberSearch:null,memberName:null,email:null,dueDate:null,books:[]}),this.bookissueedlist=[],this.bookList()},e.prototype.focus=function(){$("#memberSearch").focus()},__decorate([core_1.HostListener("document:keypress",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[KeyboardEvent]),__metadata("design:returntype",void 0)],e.prototype,"handleKeyboardEvent",null),e=__decorate([core_1.Component({selector:"ng-issue",templateUrl:"./app/backoffice/circulation/issue/component.html",providers:[service_1.DataService]}),__metadata("design:paramtypes",[router_1.Router,platform_browser_1.Title,forms_1.FormBuilder,service_1.DataService])],e)}();exports.IssueComponent=IssueComponent;